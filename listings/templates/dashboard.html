{% extends "base_webapp.html" %}
{% load static %}

{% block title %}Home{% endblock title %}

{% block page_title %}
<span>üè† Home</span>
<span>
    <a class="btn btn-sm btn-outline-blue float-end" href="{% url 'create_brokenscreen' %}">
        <span class="me-2">üì≤</span>
        <span>Ajouter un √©cran</span>
    </a>
</span>
{% endblock page_title %}

{% block page_content %}
<!-- DEBUT Stock & Opportunit√©s -->
<div class="row mb-4">
    <!-- DEBUT  Stock -->
    <div class="col-12 col-md-6 col-lg-4 mb-4">
        <ul class="list-group font-monospace shadow-sm">
            <li class="list-group-item logo-blue fs-5">üì¶ Stock {% if brand %}{{ brand.display_name|title }}{% elif recycler %}{{ recycler|title }}{% else %}total{% endif %}</li>
            <li class="list-group-item fs-6">
                <span>Nombre d'√©cran</span>
                <span class="float-end">{{ items_count }}</span>
            </li>
            <li class="list-group-item fs-6">
                <span>Valeur estim√©e</span>
                <span class="float-end">{{ items_value }} ‚Ç¨</span>
            </li>
            {% if request.resolver_match.url_name == 'dashboard' %}
            <li class="list-group-item text-end">
                <a href="{% url 'page_attente' %}" class="btn btn-sm btn-outline-blue{% if items_count == 0 %} disabled{% endif %}">Voir en d√©tail</a>
            </li>
            {% endif %}
        </ul>
    </div>
    <!-- DEBUT Opportunit√©s -->
    <div class="col-12 col-md-6 col-lg-4 mb-4 fs-5 text-blue">
        <ul class="list-group font-monospace shadow-sm">
            <li class="list-group-item logo-blue fs-5">üåü Opportunit√©s</li>
            <li class="list-group-item fs-6">
                <span>Nombre d'opportunit√©s</span>
                <span class="float-end">{{ opportunities_count }}</span>
            </li>
            <li class="list-group-item fs-6">
                <span>Gain potentiel estim√©</span>
                <span class="fw-bold text-success float-end">+ {{ opportunities_value }} ‚Ç¨</span>
            </li>
            <li class="list-group-item text-end">
                <a href="{% url 'page_attente' %}" class="btn btn-sm btn-outline-blue{% if opportunities_count == 0 %} disabled{% endif %}">Voir en d√©tail</a>
            </li>
        </ul>
    </div>
</div>

<div class="row mb-4">
    <!-- Stock Marque -->
    <div class="mb-3 fs-5 text-blue">üì± Stock par marque</div>
    {% for brand in recap_brand_table %}
    <div class="col-12 col-md-6 col-lg-4 mb-4">
        <ul class="list-group font-monospace shadow-sm">
            <li class="list-group-item logo-blue fs-5">
                <img src="{% static '/img/brand_logos/' %}{{ brand.model__brand }}.svg" class="me-2" width="20px" height="20px">{{ brand.model__brand__display_name|title }}
            </li>
            <li class="list-group-item fs-6">
                <span>Nombre d'√©cran</span>
                <span class="float-end">{{ brand.nb_item }}</span>
            </li>
            <li class="list-group-item fs-6">
                <span>Valeur estim√©e</span>
                <span class="float-end">{{ brand.total_value|default_if_none:'0'|floatformat:2 }} ‚Ç¨</span>
            </li>
            <li class="list-group-item text-end"><a href="{% url 'page_attente' brand.model__brand__ref_brand %}" class="btn btn-sm btn-outline-blue">Voir en d√©tail</a></li>
        </ul>
    </div>
    {% empty %}
    <div class="col-12 col-md-6 col-lg-4">
        <ul class="list-group font-monospace shadow-sm">
            <li class="list-group-item fs-6 fst-italic text-center">Aucun √©cran en stock</li>
            <li class="list-group-item text-end"><a href="{% url 'page_attente' %}" class="btn btn-sm btn-outline-blue">Ajouter un √©cran</a></li>
        </ul>
    </div>
    {% endfor %}
</div>

<div class="row mb-4">
    <!-- Stock Recycleur -->
    <div class="mb-3 fs-5 text-blue">üë®‚Äçüîß Stock par recycleur</div>
    {% for recycler in recap_recycler_table %}
    <div class="col-12 col-md-6 col-lg-4 mb-4">
        <ul class="list-group font-monospace shadow-sm">
            <li class="list-group-item logo-blue fs-5">
                {% if recycler.quotation__recycler__display_name is None %}
                <span class="me-2">‚ùì</span>
                {% else %}
                <span class="me-2">üë®‚Äçüîß</span>
                {% endif %}
                <span>{{ recycler.quotation__recycler__display_name|default_if_none:"Non attribu√©"|title }}</span>
            </li>
            <li class="list-group-item fs-6">
                <span>Nombre d'√©cran</span>
                <span class="float-end">{{ recycler.nb_item }}</span>
            </li>
            <li class="list-group-item fs-6">
                <span>Valeur estim√©e</span>
                <span class="float-end">{{ recycler.total_value|default_if_none:'0'|floatformat:2 }} ‚Ç¨</span>
            </li>
            <li class="list-group-item text-end"><a href="{% url 'wpage_attente' recycler.quotation__recycler__ref_recycler %}" class="btn btn-sm btn-outline-blue">Voir en d√©tail</a></li>
        </ul>
    </div>
    {% empty %}
    <div class="col-12 col-md-6 col-lg-4">
        <ul class="list-group font-monospace shadow-sm">
            <li class="list-group-item fs-6 fst-italic text-center">Aucun √©cran en stock</li>
            <li class="list-group-item text-end"><a href="{% url 'page_attente' %}" class="btn btn-sm btn-outline-blue">Ajouter un √©cran</a></li>
        </ul>
    </div>
    {% endfor %}
</div>
{% endblock page_content %}
